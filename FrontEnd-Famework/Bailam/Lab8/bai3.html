<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="js/angular.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>

<body ng-app="myapp">
    <div class="container" ng-controller="bai1">
        <div class="card">
            <div class="card-header bg-primary text-light">
                Bán hàng giải khát
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <tr>
                        <th><input type="checkbox" ng-model="selectAll" ng-change="toggleSelectAll()"></th>
                        <th>Tên hàng</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Khuyến mãi</th>
                        <th class="text-end">Tiền</th>
                        <th class="text-end">Còn lại</th>
                    </tr>
                    <tr ng-repeat="sp in sanpham | orderBy:'-price'">
                        <td><input type="checkbox" ng-model="sp.buy"></td>
                        <td>{{sp.name | uppercase}}</td>
                        <td class="text-center"><input type="number" class="text-center" ng-disabled="!sp.buy"
                                ng-model="sp.quality"></td>
                        <td>{{sp.price | number}}</td>
                        <td>{{tinhkhuyenmai(sp.quality)}}</td>
                        <td class="text-end">{{sp.price*sp.quality | number}} VNĐ</td>
                        <td class="text-end">{{(sp.price*sp.quality) - tinhkhuyenmai(sp.quality) | number}} VNĐ</td>
                    </tr>
                </table>
            </div>
            <div class="card-footer text-end">
                <b>Tổng: {{tinhtongtien() | number}} VNĐ</b>
            </div>
        </div>
    </div>
    <script>
        var app = angular.module("myapp", []);
        app.controller("bai1", function ($scope, $http) {
            $scope.sanpham = [];
            $http.get("sanpham.js").then(function (d) { $scope.sanpham = d.data })

            $scope.tinhkhuyenmai = function (sl) {
                if (sl >= 15) return 10000;
                else if (sl >= 10) return 6000;
                else if (sl >= 5) return 2000;
                else return 0;
            }

            $scope.tinhtongtien = function () {
                var tongtien = 0;
                for (var i = 0; i < $scope.sanpham.length; i++) {
                    if ($scope.sanpham[i].buy) {
                        tongtien += $scope.sanpham[i].price * $scope.sanpham[i].quality;
                    }
                }
                return tongtien;
            }
            $scope.selectAll = false;
            $scope.toggleSelectAll = function () {
                // Khi chọn checkbox "Select All", cập nhật trạng thái của tất cả các checkbox khác
                angular.forEach($scope.sanpham, function (sp) {
                    sp.buy = $scope.selectAll;
                });
            };
        });
    </script>
</body>

</html>